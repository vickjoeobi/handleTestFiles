# Handle Test File GitHub Action

This custom GitHub Action handles test files by checking for their existence in a repository, validating their content against an expected set of keys, and then updating a GitHub Gist with the combined data from the initial file and the repository file.

## Inputs

| Name | Description | Required |
| --- | --- | --- |
| gist_id | GitHub Gist ID | Yes |
| initial_filename | Initial file name in the Gist | Yes |
| final_filename | Final file name in the Gist | Yes |
| expected_test_data_array | JSON string representing an array of expected test data keys | Yes |
| file_path | File path of the JSON file in the repo | Yes |
| token | GitHub token (PAT or GITHUB_TOKEN) this token is to help us access the file in the repo, especially if the repo is private. ***This token will be generated by the teams using the action and added to their repo secret. Ensure that the repo access is given while creating the PAT.  | Yes |

## Usage

Create a new GitHub Action workflow file in your repository (e.g., `.github/workflows/handle-test-file.yml`) and add the following content:

```
name: Handle Test File

on:
  workflow_dispatch:

jobs:
  handle_test_file:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Handle Test File
      uses: vickjoeobi/handleTestFiles@main
      with:
        gist_id: "gist_id"
        initial_filename: initial_file_name.json
        final_filename: final_file_name.json
        expected_test_data_array: '["key1", "key2", "key3"]'
        file_path: path/to/your/file.json
        token: ${{ secrets.PAT }}
```

**Note**: Make sure to use a GitHub token (either a Personal Access Token or the `GITHUB_TOKEN` provided by the GitHub Actions environment) and store it as a secret in your repository (e.g., `secrets.PAT`).

## How it works

1. The action checks if the JSON file exists in the specified repository and file path.
2. It then checks if the provided Gist ID is valid and if the initial file exists in the Gist.
3. The content of the JSON file in the repository is validated against the expected set of keys provided in the `expected_test_data_array` input.
4. If all checks pass, the action combines the content of the initial file in the Gist and the JSON file in the repository.
5. The combined content is then used to create or update the final file in the Gist, as specified by the `final_filename` input.
6. If any errors occur during the process, the action will throw an error and stop the pipeline.
